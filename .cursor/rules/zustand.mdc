---
description: éµå¾ªç¤¾ç¾¤æœ€ä½³å¯¦è¸ï¼Œé«˜æ•ˆã€å®‰å…¨åœ°ä½¿ç”¨ Zustand é€²è¡Œç‹€æ…‹ç®¡ç†ã€‚
globs:
  - "**/*.{ts,tsx,js,jsx}"
alwaysApply: true
---

# é«˜æ•ˆä½¿ç”¨ Zustand çš„äº”é …æœ€ä½³å¯¦è¸

æœ¬æŒ‡å—æç…‰è‡ª TkDodo çš„æ–‡ç«  "Working with Zustand"ï¼Œæ—¨åœ¨æä¾›æ¸…æ™°ã€å¯è¡Œçš„ Zustand ä½¿ç”¨æº–å‰‡ï¼Œä»¥æå‡æ‡‰ç”¨ç¨‹å¼æ•ˆèƒ½èˆ‡ç¨‹å¼ç¢¼å“è³ªã€‚

## 1. åªå°å‡ºå®¢è£½åŒ– Hooks (Selectors)

é€™æ˜¯æœ€é‡è¦çš„åŸå‰‡ã€‚æ°¸é ä¸è¦ç›´æ¥å°å‡º `create` å‰µå»ºçš„æ•´å€‹ store å¯¦ä¾‹ã€‚æ‡‰è©²ç‚º store ä¸­çš„æ¯å€‹ state ç‰‡æ®µå»ºç«‹ä¸¦å°å‡ºå°ˆå±¬çš„ selector hookã€‚

**ç†ç”±ï¼š**
*   **é˜²æ­¢æ„å¤–è¨‚é–±æ•´å€‹ store**ï¼šå¦‚æœç›´æ¥ä½¿ç”¨ `const { bears } = useBearStore()`ï¼Œå…ƒä»¶æœƒè¨‚é–±æ•´å€‹ storeï¼Œä»»ä½•ç‹€æ…‹ï¼ˆå³ä½¿æ˜¯ç„¡é—œçš„ï¼‰è®Šæ›´éƒ½æœƒå°è‡´ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚
*   **æä¾›æ›´æ¸…æ™°çš„ API**ï¼šå…ƒä»¶åªéœ€è¦å°å…¥å®ƒçœŸæ­£éœ€è¦çš„ hookï¼Œä¾‹å¦‚ `useBears()`ï¼Œè€Œä¸éœ€è¦é—œå¿ƒ store çš„å…§éƒ¨çµæ§‹ã€‚

```typescript
// ä¸ä½³ï¼šç›´æ¥å°å‡º store
export const useBearStore = create((set) => ({
  bears: 0,
  fish: 0,
  // ...actions
}));

// è‰¯å¥½ï¼šåªå°å‡º selector hooks
const useBearStore = create<BearState>((set) => ({
  bears: 0,
  fish: 0,
  // ...actions
}));

export const useBears = () => useBearStore((state) => state.bears);
export const useFish = () => useBearStore((state) => state.fish);
```

## 2. åå¥½ä½¿ç”¨åŸå­åŒ–çš„ Selectors

ç›¡é‡è®“æ¯å€‹ selector åªè¿”å›ä¸€å€‹ state çš„æœ€å°å–®ä½ï¼ˆä¾‹å¦‚ä¸€å€‹æ•¸å­—ã€å­—ä¸²æˆ–å¸ƒæ—å€¼ï¼‰ã€‚

**ç†ç”±ï¼š**
*   **é¿å…æ•ˆèƒ½é™·é˜±**ï¼šZustand é è¨­ä½¿ç”¨åš´æ ¼ç›¸ç­‰ï¼ˆ`===`ï¼‰ä¾†åˆ¤æ–·ç‹€æ…‹æ˜¯å¦è®Šæ›´ã€‚å¦‚æœ selector è¿”å›ä¸€å€‹æ–°ç‰©ä»¶æˆ–é™£åˆ—ï¼ˆä¾‹å¦‚ `(state) => ({ bears: state.bears, fish: state.fish })`ï¼‰ï¼Œå³ä½¿å…§å®¹å®Œå…¨æ²’è®Šï¼Œå®ƒä¹Ÿæœƒè¢«è¦–ç‚ºã€Œå·²è®Šæ›´ã€ï¼Œå°è‡´ä¸å¿…è¦çš„æ¸²æŸ“ã€‚
*   **ä¿æŒç°¡å–®**ï¼šé›–ç„¶å¯ä»¥ä½¿ç”¨ `shallow` æ¯”è¼ƒï¼Œä½†å»ºç«‹å¤šå€‹åŸå­åŒ–çš„ selector hook æ›´ç°¡å–®ã€æ›´ç›´è§€ã€‚å¦‚æœä¸€å€‹å…ƒä»¶éœ€è¦å¤šå€‹ç‹€æ…‹ï¼Œå°±ä½¿ç”¨å¤šå€‹ hooksã€‚

```typescript
// ä¸ä½³ï¼šè¿”å›ç‰©ä»¶ï¼Œå¯èƒ½å°è‡´ä¸å¿…è¦çš„æ¸²æŸ“
const { bears, fish } = useBearStore((state) => ({
  bears: state.bears,
  fish: state.fish,
}));

// è‰¯å¥½ï¼šä½¿ç”¨å…©å€‹ç¨ç«‹çš„åŸå­åŒ– selector
const bears = useBears();
const fish = useFish();
```

## 3. å°‡ Actions èˆ‡ State åˆ†é›¢

åœ¨ store å…§éƒ¨ï¼Œå°‡æ›´æ–°ç‹€æ…‹çš„å‡½å¼ï¼ˆactionsï¼‰èˆ‡ç‹€æ…‹æœ¬èº«ï¼ˆstateï¼‰åˆ†é–‹å­˜æ”¾ã€‚

**ç†ç”±ï¼š**
*   **æ•ˆèƒ½å„ªåŒ–**ï¼šActions æœ¬èº«æ˜¯éœæ…‹çš„ï¼Œå®ƒå€‘çš„å¼•ç”¨æ°¸é ä¸æœƒæ”¹è®Šã€‚å°‡å®ƒå€‘çµ„åˆåœ¨ä¸€å€‹ç‰©ä»¶ä¸­ï¼Œå¯ä»¥å»ºç«‹ä¸€å€‹å–®ç¨çš„ hookï¼ˆä¾‹å¦‚ `useBearActions`ï¼‰ä¾†ç²å–æ‰€æœ‰ actionsï¼Œè€Œé€™å€‹ hook æ°¸é ä¸æœƒè§¸ç™¼å…ƒä»¶çš„é‡æ–°æ¸²æŸ“ã€‚
*   **çµ„ç¹”æ¸…æ™°**ï¼šå°‡ç‹€æ…‹å’Œæ“ä½œç‹€æ…‹çš„æ–¹æ³•åˆ†é–‹ï¼Œä½¿ store çš„çµæ§‹æ›´æ¸…æ™°ã€‚

```typescript
const useBearStore = create<BearState>((set) => ({
  bears: 0,
  fish: 0,
  // â¬‡ï¸ å°‡ actions æ”¾åœ¨ç¨ç«‹çš„ "namespace"
  actions: {
    increasePopulation: (by) =>
      set((state) => ({ bears: state.bears + by })),
    eatFish: () => set((state) => ({ fish: state.fish - 1 })),
  },
}));

export const useBears = () => useBearStore((state) => state.bears);

// ğŸ‰ ä¸€å€‹ selector ç²å–æ‰€æœ‰ actionsï¼Œä¸”ä¸æœƒè§¸ç™¼é‡æ¸²æŸ“
export const useBearActions = () => useBearStore((state) => state.actions);

// åœ¨å…ƒä»¶ä¸­ä½¿ç”¨
const { increasePopulation } = useBearActions();
```

## 4. å°‡ Actions å»ºæ¨¡ç‚ºäº‹ä»¶ï¼Œè€Œé Setters

Actions æ‡‰è©²ä»£è¡¨ã€Œä½¿ç”¨è€…æ„åœ–ã€æˆ–ã€Œæ‡‰ç”¨ç¨‹å¼äº‹ä»¶ã€ï¼ˆä¾‹å¦‚ `increasePopulation`ï¼‰ï¼Œè€Œä¸æ˜¯å–®ç´”çš„ `setBears`ã€‚

**ç†ç”±ï¼š**
*   **æ¥­å‹™é‚è¼¯å…§èš**ï¼šå°‡æ¥­å‹™é‚è¼¯ä¿ç•™åœ¨ store å…§éƒ¨ï¼Œè€Œä¸æ˜¯æ•£è½åœ¨å„å€‹å…ƒä»¶ä¸­ã€‚å…ƒä»¶åªè² è²¬è§¸ç™¼äº‹ä»¶ï¼Œstore æ±ºå®šå¦‚ä½•éŸ¿æ‡‰é€™å€‹äº‹ä»¶ä¾†æ›´æ–°ç‹€æ…‹ã€‚
*   **å¯ç¶­è­·æ€§**ï¼šç•¶æ¥­å‹™é‚è¼¯éœ€è¦è®Šæ›´æ™‚ï¼Œåªéœ€è¦ä¿®æ”¹ store ä¸­çš„ actionï¼Œè€Œä¸éœ€è¦å»å°‹æ‰¾ä¸¦ä¿®æ”¹æ‰€æœ‰ä½¿ç”¨åˆ°å®ƒçš„å…ƒä»¶ã€‚

## 5. ä¿æŒ Store çš„ç¯„ç–‡å°è€Œå°ˆæ³¨

èˆ‡ Redux æå€¡çš„å–®ä¸€å…¨å±€ store ä¸åŒï¼ŒZustand é¼“å‹µä½ å»ºç«‹å¤šå€‹ã€å°è€Œå°ˆæ³¨çš„ storesï¼Œæ¯å€‹ store åªè² è²¬ä¸€å¡Šç‰¹å®šçš„æ¥­å‹™é ˜åŸŸæˆ–åŠŸèƒ½ã€‚

**ç†ç”±ï¼š**
*   **é«˜å…§èšï¼Œä½è€¦åˆ**ï¼šæ¯å€‹ store éƒ½æ›´å°ã€æ›´æ˜“æ–¼ç†è§£å’Œæ¸¬è©¦ã€‚
*   **éˆæ´»çµ„åˆ**ï¼šå¦‚æœéœ€è¦åœ¨ä¸åŒ stores ä¹‹é–“å…±äº«ç‹€æ…‹ï¼Œå¯ä»¥ä½¿ç”¨å®¢è£½åŒ– hook ä¾†çµ„åˆå®ƒå€‘ï¼Œè€Œä¸æ˜¯å»ºç«‹è¤‡é›œçš„ store çµæ§‹ã€‚

```typescript
// é€éå®¢è£½åŒ– hook çµ„åˆä¸åŒçš„ stores
const currentUser = useCredentialsStore((state) => state.currentUser);
const user = useUsersStore((state) => state.users[currentUser]);
```

åƒè€ƒè³‡æ–™ï¼š[Working with Zustand by TkDodo](https://tkdodo.eu/blog/working-with-zustand)
