import{p as e,y as _,I as L,a as i,G as F,J as q}from"./chunk-4WY6JWTD-2Cr-QbDP.js";import{t as B,u as S,P as I,j as T,O as $}from"./gql-Mx7Ziu-8.js";import{l as p}from"./lodash-lK2eycnc.js";import{b as h}from"./index-Ck08PhAW.js";import{C as G,c as O,m as Y,S as K,B as Q,b as U,f as A}from"./SummaryPanel-BFEcsSno.js";import{p as W,e as V}from"./visualization.queries-BUVrj-cD.js";import"./helpers-DCGy3gpM.js";import"./index-CSMLMQiO.js";import"./index-CtMSh7YR.js";const H=(s,a)=>a>1&&s<a-1?"border-b border-gray-200":"",J=({data:s,presenterDescription:a="",yearToCommitteeMap:l,onNodeClick:n})=>{const o=h("(min-width: 768px)"),t=h("(min-width: 1024px)"),m=h("(min-width: 1440px)"),f=h("(min-width: 1920px)"),j=()=>f?1800:m?1400:t?1e3:720;if(!s||s.length===0)return e.jsx("div",{className:"flex w-full items-center justify-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"目前無提案資料"})});const u=j(),y={maxWidth:`${u}px`};return e.jsx(e.Fragment,{children:s.map((d,r)=>e.jsxs("div",{className:`mb-2 flex w-full flex-col items-start justify-center ${H(r,s.length)} mx-auto`,style:y,children:[e.jsxs("div",{className:"flex w-full flex-col items-start justify-center",children:[e.jsx("p",{children:d.name}),e.jsx("p",{children:l.get(d.name)??"委員會"}),a?e.jsx("div",{className:"flex w-full flex-col items-start justify-center mb-5 lg:mb-8",children:e.jsx("p",{className:"text-sm leading-relaxed text-black/80",children:a})}):null]}),e.jsx("div",{className:"w-full md:mx-auto",children:e.jsx(G,{data:{id:d.id,name:"root",children:d.children},width:u,padding:50,onNodeClick:n})})]},d.id))})},Z=B(`
  query People($where: PeopleWhereUniqueInput!) {
    people(where: $where) {
      id
      name
      description
      party {
        id
        color
        name
      }
      term {
        termNumber
        id
      }
      termCount
      committees {
        id
        name
        session
        term {
          id
          startDate
          termNumber
        }
      }
    }
  }
`),N={all:["people"],details:()=>[...N.all,"detail"],detail:s=>[...N.details(),s]},X=()=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"md:max-w-visualization-body flex flex-col items-center gap-y-6 px-3 md:mx-auto",children:[e.jsx("div",{className:"h-4 w-24 self-start rounded bg-gray-200"}),e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-6 w-32 rounded bg-gray-200"}),e.jsx("div",{className:"h-5 w-28 rounded bg-gray-200"}),e.jsx("div",{className:"h-5 w-40 rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex gap-x-4",children:[e.jsx("div",{className:"h-9 w-24 rounded bg-gray-200"}),e.jsx("div",{className:"h-9 w-24 rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"h-5 w-44 rounded bg-gray-200"}),e.jsx("div",{className:"h-5 w-56 rounded bg-gray-200"})]}),e.jsx("div",{className:"w-full rounded-lg border-2 border-dashed border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-48 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-52 rounded bg-gray-200"})]})}),e.jsx("div",{className:"h-10 w-full rounded bg-gray-200"}),e.jsx("div",{className:"flex w-full flex-col gap-y-6",children:[0,1].map(s=>e.jsxs("div",{className:"flex flex-col gap-y-3 rounded-lg border border-dashed border-gray-200 p-4",children:[e.jsx("div",{className:"h-5 w-32 rounded bg-gray-200"}),e.jsx("div",{className:"h-72 w-full rounded bg-gray-200"})]},s))})]})}),ee=()=>e.jsx("div",{className:"animate-pulse px-3",children:e.jsxs("div",{className:"flex flex-col items-center gap-y-5",children:[e.jsx("div",{className:"h-4 w-20 self-start rounded bg-gray-200"}),e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-5 w-28 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-24 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-36 rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex w-full flex-col gap-y-3",children:[e.jsx("div",{className:"h-9 w-full rounded bg-gray-200"}),e.jsx("div",{className:"h-9 w-full rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-y-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-44 rounded bg-gray-200"})]}),e.jsx("div",{className:"w-full rounded-lg border-2 border-dashed border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-4 w-36 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-40 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-32 rounded bg-gray-200"})]})}),e.jsx("div",{className:"h-10 w-full rounded bg-gray-200"}),e.jsx("div",{className:"flex w-full flex-col gap-y-5",children:[0,1].map(s=>e.jsxs("div",{className:"flex flex-col gap-y-2 rounded-lg border border-dashed border-gray-200 p-4",children:[e.jsx("div",{className:"h-4 w-28 rounded bg-gray-200"}),e.jsx("div",{className:"h-64 w-full rounded bg-gray-200"})]},s))})]})}),se=({isDesktop:s})=>s?e.jsx(X,{}):e.jsx(ee,{}),ae=(s,a)=>{const l={mergedParentProposals:null,historicalParentProposals:null};return s==="proposal-cosign"?{...l,OR:[{proposers:{some:{id:{equals:a}}}},{coSigners:{some:{id:{equals:a}}}}]}:{...l,proposers:{some:{id:{equals:a}}}}},re=s=>{if(!s)return new Map;const a=new Map;return s.forEach(l=>{var n;if((n=l.term)!=null&&n.startDate){const o=new Date(l.term.startDate).getFullYear()-1911+1;a.set(`${o}年度`,l.name??"委員會")}}),a},k=s=>s?s.map(a=>a==null?void 0:a.termNumber).filter(a=>a!=null):[],te=(s,a)=>{if(!s&&!a)return[];const l=k((s==null?void 0:s.map(o=>o.term))??[]),n=k(a);return[...new Set([...l,...n])].sort((o,t)=>o-t)},le=s=>{const a=p.sumBy(s,t=>t.reductionAmount||0),l=p.sumBy(s,t=>t.freezeAmount||0),n=p.filter(s,t=>t.reductionAmount).length,c=p.filter(s,t=>t.freezeAmount).length,o=p.filter(s,t=>{var m;return(m=t.proposalTypes)==null?void 0:m.includes(I.Other)}).length;return{formattedReductionAmount:A(a),formattedFreezeAmount:A(l),reductionProposalsCount:n,freezeProposalsCount:c,mainResolutionCount:o}},ne=({personName:s,partyName:a,termNumbers:l})=>{const n=l.length?`第${l.join("、")}屆`:"";return e.jsxs("div",{className:"mt-4 flex min-w-[254px] flex-col items-center justify-center gap-y-2 border-b-2 border-black pb-3 lg:flex-row lg:items-end lg:gap-x-5",children:[e.jsx("p",{className:"text-[36px] md:text-[32px]",children:s}),e.jsx("p",{children:a}),n?e.jsxs("p",{className:"flex flex-wrap justify-center gap-x-2",children:[e.jsx("span",{className:"whitespace-nowrap",children:n}),e.jsx("span",{children:"立法委員"})]}):e.jsx("p",{children:"立法委員"})]})},oe=({selectedType:s,onChange:a})=>e.jsxs("div",{className:"mt-6 flex items-center gap-x-4",children:[e.jsx("button",{className:`rounded border-2 border-black px-2.5 ${s==="proposal"?"bg-brand-primary text-white":""}`,onClick:()=>a("proposal"),children:"提案"}),e.jsx("button",{className:`rounded border-2 border-black px-2.5 ${s==="proposal-cosign"?"bg-brand-primary text-white":""}`,onClick:()=>a("proposal-cosign"),children:"提案＋連署"})]}),ie=({mode:s,onChange:a})=>e.jsx("div",{children:e.jsxs("div",{className:"mt-4 flex flex-col items-center justify-center gap-4 lg:flex-row lg:gap-6 lg:text-left",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"viz-mode",value:"amount",checked:s==="amount",onChange:()=>a("amount"),className:"accent-brand-primary h-4 w-4"}),e.jsx("span",{children:"依金額（刪減/凍結）"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"viz-mode",value:"count",checked:s==="count",onChange:()=>a("count"),className:"accent-brand-primary h-4 w-4"}),e.jsx("span",{children:"依數量（凍結案/刪減案/建議案）"})]})]})}),de=()=>{var C;const{id:s}=L(),[a,l]=i.useState("proposal"),[n,c]=i.useState("amount"),o=i.useMemo(()=>ae(a,s),[a,s]),{data:t,isLoading:m,isError:f}=S({queryKey:W.list({whereFilter:o}),queryFn:()=>T(V,{skip:0,take:1e3,orderBy:[{id:$.Desc}],where:o})}),j=i.useMemo(()=>t?O(t,n):[],[t,n]),{data:u,isLoading:y,isError:d}=S({queryKey:N.detail(s??""),queryFn:()=>T(Z,{where:{id:s}}),enabled:!!s}),r=u==null?void 0:u.people,g=r==null?void 0:r.committees,E=i.useMemo(()=>re(g),[g]),z=i.useMemo(()=>te(g,r==null?void 0:r.term),[g,r==null?void 0:r.term]),v=Y(t),x=i.useMemo(()=>le(v),[v]),D=i.useMemo(()=>({formattedReductionAmount:x.formattedReductionAmount,formattedFreezeAmount:x.formattedFreezeAmount,reductionCount:x.reductionProposalsCount,freezeCount:x.freezeProposalsCount,mainResolutionCount:x.mainResolutionCount}),[x]),R=h("(min-width: 768px)"),w=F(),M=i.useCallback(b=>{var P;return!((P=b.children)!=null&&P.length)&&b.id?(w(`/budget/${b.id}`),!0):!1},[w]);return m||y?e.jsx(se,{isDesktop:R}):f||d?e.jsx("div",{children:"Error fetching data"}):e.jsx("div",{children:e.jsxs("div",{className:"md:max-w-visualization-body flex flex-col items-center justify-center px-3 md:mx-auto",children:[e.jsxs(q,{to:"/visualization",children:["<"," 回到視覺化主頁"]}),e.jsx(ne,{personName:r==null?void 0:r.name,partyName:(C=r==null?void 0:r.party)==null?void 0:C.name,termNumbers:z}),e.jsx(oe,{selectedType:a,onChange:l}),e.jsx(ie,{mode:n,onChange:c}),e.jsx(K,{summary:D}),e.jsx("div",{className:"mt-6",children:e.jsx(Q,{items:U})}),e.jsx(J,{data:j,presenterDescription:r==null?void 0:r.description,yearToCommitteeMap:E,onNodeClick:M})]})})},ye=_(de);export{ye as default};
