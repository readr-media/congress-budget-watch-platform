import{a as i,p as e,y as k,I as _,J as z}from"./chunk-OIYGIGL5-DIb7gZ_H.js";import{t as D,u as b,P as M,j as v,O as L}from"./gql-DSg_pHIo.js";import{l as x}from"./lodash-CO_AqOBJ.js";import{u as h}from"./helpers-By--BNaP.js";import{C as R,c as q,m as B,B as F,b as I,f as w}from"./legends-DLpM5dC8.js";import{p as O,e as $}from"./visualization.queries-Du6_GLIo.js";const G=(s,r)=>r>1&&s<r-1?"border-b border-gray-200":"",Y=({data:s,yearToCommitteeMap:r})=>{const a=h("(min-width: 768px)"),n=h("(min-width: 1024px)"),d=h("(min-width: 1440px)"),t=h("(min-width: 1920px)"),c=()=>{if(t)return 1800;if(d)return 1400;if(n)return 1e3;if(a)return 720};return i.useEffect(()=>{}),!s||s.length===0?e.jsx("div",{className:"flex w-full items-center justify-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"目前無提案資料"})}):e.jsx(e.Fragment,{children:s.map((o,g)=>e.jsxs("div",{className:`mb-2 flex w-full flex-col items-start justify-center ${G(g,s.length)}`,children:[e.jsxs("div",{className:"flex flex-col items-start justify-center",children:[e.jsx("p",{children:o.name}),e.jsx("p",{children:r.get(o.name)??"委員會"})]}),e.jsx("div",{className:"md:mx-auto",children:e.jsx(R,{data:{id:o.id,name:"root",children:o.children},width:c(),padding:50})})]},o.id))})},K=D(`
  query People($where: PeopleWhereUniqueInput!) {
    people(where: $where) {
      id
      name
      party {
        id
        color
        name
      }
      term {
        termNumber
        id
      }
      termCount
      committees {
        id
        name
        session
        term {
          id
          startDate
          termNumber
        }
      }
    }
  }
`),f={all:["people"],details:()=>[...f.all,"detail"],detail:s=>[...f.details(),s]},Q=s=>!s.first||!s.last?"":s.first===s.last?String(s.first):`${s.first} ~ ${s.last}`,U=()=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"flex flex-col items-center gap-y-6 px-3 md:mx-auto md:max-w-visualization-body",children:[e.jsx("div",{className:"self-start h-4 w-24 rounded bg-gray-200"}),e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-6 w-32 rounded bg-gray-200"}),e.jsx("div",{className:"h-5 w-28 rounded bg-gray-200"}),e.jsx("div",{className:"h-5 w-40 rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex gap-x-4",children:[e.jsx("div",{className:"h-9 w-24 rounded bg-gray-200"}),e.jsx("div",{className:"h-9 w-24 rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"h-5 w-44 rounded bg-gray-200"}),e.jsx("div",{className:"h-5 w-56 rounded bg-gray-200"})]}),e.jsx("div",{className:"w-full rounded-lg border-2 border-dashed border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-48 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-52 rounded bg-gray-200"})]})}),e.jsx("div",{className:"h-10 w-full rounded bg-gray-200"}),e.jsx("div",{className:"flex w-full flex-col gap-y-6",children:[0,1].map(s=>e.jsxs("div",{className:"flex flex-col gap-y-3 rounded-lg border border-dashed border-gray-200 p-4",children:[e.jsx("div",{className:"h-5 w-32 rounded bg-gray-200"}),e.jsx("div",{className:"h-72 w-full rounded bg-gray-200"})]},s))})]})}),V=()=>e.jsx("div",{className:"animate-pulse px-3",children:e.jsxs("div",{className:"flex flex-col items-center gap-y-5",children:[e.jsx("div",{className:"self-start h-4 w-20 rounded bg-gray-200"}),e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-5 w-28 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-24 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-36 rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex w-full flex-col gap-y-3",children:[e.jsx("div",{className:"h-9 w-full rounded bg-gray-200"}),e.jsx("div",{className:"h-9 w-full rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-y-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-44 rounded bg-gray-200"})]}),e.jsx("div",{className:"w-full rounded-lg border-2 border-dashed border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-4 w-36 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-40 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-32 rounded bg-gray-200"})]})}),e.jsx("div",{className:"h-10 w-full rounded bg-gray-200"}),e.jsx("div",{className:"flex w-full flex-col gap-y-5",children:[0,1].map(s=>e.jsxs("div",{className:"flex flex-col gap-y-2 rounded-lg border border-dashed border-gray-200 p-4",children:[e.jsx("div",{className:"h-4 w-28 rounded bg-gray-200"}),e.jsx("div",{className:"h-64 w-full rounded bg-gray-200"})]},s))})]})}),W=({isDesktop:s})=>s?e.jsx(U,{}):e.jsx(V,{}),H=(s,r)=>s==="proposal-cosign"?{OR:[{proposers:{some:{id:{equals:r}}}},{coSigners:{some:{id:{equals:r}}}}]}:{proposers:{some:{id:{equals:r}}}},J=s=>{if(!s)return new Map;const r=new Map;return s.forEach(l=>{var a;if((a=l.term)!=null&&a.startDate){const d=new Date(l.term.startDate).getFullYear()-1911+1;r.set(`${d}年度`,l.name??"委員會")}}),r},Z=s=>{if(!s)return{first:null,last:null};const r=s.map(a=>{var n;return(n=a.term)==null?void 0:n.termNumber}).filter(a=>a!=null);if(r.length===0)return{first:null,last:null};const l=[...new Set(r)].sort((a,n)=>a-n);return{first:l[0],last:l[l.length-1]}},X=s=>{const r=x.sumBy(s,t=>t.reductionAmount||0),l=x.sumBy(s,t=>t.freezeAmount||0),a=x.filter(s,t=>t.reductionAmount).length,n=x.filter(s,t=>t.freezeAmount).length,d=x.filter(s,t=>{var c;return(c=t.proposalTypes)==null?void 0:c.includes(M.Other)}).length;return{formattedReductionAmount:w(r),formattedFreezeAmount:w(l),reductionProposalsCount:a,freezeProposalsCount:n,mainResolutionCount:d}},ee=({personName:s,partyName:r,termRange:l})=>e.jsxs("div",{className:"mt-4 flex flex-col items-center justify-center gap-y-2",children:[e.jsx("p",{children:s}),e.jsx("p",{children:r}),e.jsxs("p",{children:["第",Q(l),"屆立法委員"]})]}),se=({selectedType:s,onChange:r})=>e.jsxs("div",{className:"mt-6 flex items-center gap-x-4",children:[e.jsx("button",{className:`rounded border-2 border-black px-2.5 ${s==="proposal"?"bg-brand-primary text-white":""}`,onClick:()=>r("proposal"),children:"提案"}),e.jsx("button",{className:`rounded border-2 border-black px-2.5 ${s==="proposal-cosign"?"bg-brand-primary text-white":""}`,onClick:()=>r("proposal-cosign"),children:"提案＋連署"})]}),re=({mode:s,onChange:r})=>e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"viz-mode",value:"amount",checked:s==="amount",onChange:()=>r("amount"),className:"accent-brand-primary h-4 w-4"}),e.jsx("span",{children:"依金額（刪減/凍結）"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"viz-mode",value:"count",checked:s==="count",onChange:()=>r("count"),className:"accent-brand-primary h-4 w-4"}),e.jsx("span",{children:"依數量（凍結案/刪減案/建議案）"})]})]})}),ae=({summary:s})=>e.jsxs("div",{className:"mt-4 flex flex-col items-center justify-center rounded-lg border-2 p-2.5",children:[e.jsxs("p",{children:["總共刪減",e.jsx("span",{className:"text-brand-accent",children:s.formattedReductionAmount}),"（",e.jsx("span",{className:"text-brand-accent",children:s.reductionProposalsCount}),"個提案）"]}),e.jsxs("p",{children:["凍結",e.jsx("span",{className:"text-brand-accent",children:s.formattedFreezeAmount}),"（",e.jsx("span",{className:"text-brand-accent",children:s.freezeProposalsCount}),"個提案）"]}),e.jsxs("p",{children:["主決議提案數：",e.jsx("span",{className:"text-brand-accent",children:s.mainResolutionCount}),"個"]})]}),te=()=>{var y,N;const{id:s}=_(),[r,l]=i.useState("proposal"),[a,n]=i.useState("amount"),d=i.useMemo(()=>H(r,s),[r,s]),{data:t,isLoading:c,isError:o}=b({queryKey:O.list({whereFilter:d}),queryFn:()=>v($,{skip:0,take:1e3,orderBy:[{id:L.Desc}],where:d})}),g=i.useMemo(()=>t?q(t,a):[],[t,a]),{data:m,isLoading:C,isError:P}=b({queryKey:f.detail(s??""),queryFn:()=>v(K,{where:{id:s}}),enabled:!!s}),p=(y=m==null?void 0:m.people)==null?void 0:y.committees,S=i.useMemo(()=>J(p),[p]),T=i.useMemo(()=>Z(p),[p]),u=m==null?void 0:m.people,j=B(t),E=i.useMemo(()=>X(j),[j]),A=h("(min-width: 768px)");return c||C?e.jsx(W,{isDesktop:A}):o||P?e.jsx("div",{children:"Error fetching data"}):e.jsx("div",{children:e.jsxs("div",{className:"md:max-w-visualization-body flex flex-col items-center justify-center px-3 md:mx-auto",children:[e.jsxs(z,{to:"/visualization",children:["<"," 回到視覺化主頁"]}),e.jsx(ee,{personName:u==null?void 0:u.name,partyName:(N=u==null?void 0:u.party)==null?void 0:N.name,termRange:T}),e.jsx(se,{selectedType:r,onChange:l}),e.jsx(re,{mode:a,onChange:n}),e.jsx(ae,{summary:E}),e.jsx("div",{className:"mt-6",children:e.jsx(F,{items:I})}),e.jsx(Y,{data:g,yearToCommitteeMap:S})]})})},me=k(te);export{me as default};
