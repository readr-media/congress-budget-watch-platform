import{p as r,a as p}from"./chunk-OIYGIGL5-DIb7gZ_H.js";import{u as v,j}from"./gql-DSg_pHIo.js";import{I as b,g as C,h as N,i as w,j as E}from"./visualization.queries-Du6_GLIo.js";import{d as c}from"./index-BlK6dkO0.js";import{c as I,a as f}from"./options-BoF2LHqo.js";import{y as i}from"./middleware-LrYt1IWH.js";import"./progress-stages-526PVMKw.js";import"./helpers-By--BNaP.js";import"./lodash-CO_AqOBJ.js";import"./hoist-non-react-statics.cjs-CvxfP7dU.js";import"./index-BDok_5E1.js";const h={pageTitle:"選擇預算分類方式:",options:[{title:"全部",value:"all"},{title:"依部會分類",value:"by-department"},{title:"依立委分類",value:"by-legislator"}]},x=d=>r.jsx(I.DropdownIndicator,{...d,children:r.jsx(b,{src:"/icon/dropdown-container.svg",alt:"dropdown",className:"h-2 w-2.5"})}),F=({value:d})=>{const a=i(c,s=>s.state.departmentFilter),u=i(c,s=>s.actions.setDepartmentCategory),o=i(c,s=>s.actions.setDepartmentId),{data:l,isLoading:m}=v({queryKey:C.lists(),queryFn:()=>j(N),enabled:d==="by-department"});p.useEffect(()=>{console.log("governmentsData",l)});const g=p.useMemo(()=>l!=null&&l.governments?Array.from(new Set(l.governments.map(e=>e.category).filter(e=>e!=null&&e!==""))).sort().map(e=>({value:e,label:e})):[],[l==null?void 0:l.governments]),t=p.useMemo(()=>!(l!=null&&l.governments)||!a.category?[]:l.governments.filter(e=>e.category===a.category).map(e=>({value:e.id,label:e.name||"未命名機關"})).sort((e,S)=>e.label.localeCompare(S.label)),[l==null?void 0:l.governments,a.category]);p.useEffect(()=>{console.log("Department filter state:",{departmentFilter:a,categoryOptions:g,departmentOptions:t})},[a,g,t]);const n=a.category?{value:a.category,label:a.category}:null,y=p.useMemo(()=>{if(!a.departmentId||!(l!=null&&l.governments))return null;const s=l.governments.find(e=>e.id===a.departmentId);return s?{value:s.id,label:s.name||"未命名機關"}:null},[a.departmentId,l==null?void 0:l.governments]);return d!=="by-department"?null:r.jsxs("div",{className:"flex flex-col gap-y-3 md:flex-row md:gap-x-2",children:[r.jsx(f,{value:n,onChange:s=>{const e=s;u((e==null?void 0:e.value)||null)},options:g,components:{DropdownIndicator:x},styles:{control:s=>({...s,border:"2px solid black"}),indicatorSeparator:s=>({...s,display:"none"})},placeholder:m?"載入中...":"選擇機關類別",isLoading:m,isClearable:!0,"aria-label":"選擇機關類別"}),r.jsx(f,{value:y,onChange:s=>{const e=s;o((e==null?void 0:e.value)||null)},options:t,components:{DropdownIndicator:x},styles:{control:s=>({...s,border:"2px solid black"}),indicatorSeparator:s=>({...s,display:"none"})},placeholder:a.category?t.length===0?"此類別無機關":"選擇機關名稱":"請先選擇類別",isDisabled:!a.category||t.length===0,isClearable:!0,"aria-label":"選擇機關名稱"})]})},V=({value:d})=>{const a=i(c,t=>t.state.peopleFilter.personId),u=i(c,t=>t.actions.setPersonId),{data:o,isLoading:l}=v({queryKey:w.lists(),queryFn:()=>j(E),enabled:d==="by-legislator"}),m=p.useMemo(()=>o!=null&&o.peopleList?o.peopleList.filter(t=>t.name).map(t=>{var n;return{value:t.id,label:t.name||"未命名",party:((n=t.party)==null?void 0:n.name)||null}}).sort((t,n)=>t.label.localeCompare(n.label)):[],[o==null?void 0:o.peopleList]);p.useEffect(()=>{console.log("People filter state:",{personId:a,peopleOptions:m})},[a,m]);const g=p.useMemo(()=>{if(!a||!(o!=null&&o.peopleList))return null;const t=o.peopleList.find(n=>n.id===a);return t?{value:t.id,label:t.name||"未命名"}:null},[a,o==null?void 0:o.peopleList]);return d!=="by-legislator"?null:r.jsx("div",{className:"flex flex-col gap-y-3",children:r.jsx(f,{value:g,onChange:t=>{const n=t;u((n==null?void 0:n.value)||null)},options:m,components:{DropdownIndicator:x},className:"md:w-96",styles:{control:t=>({...t,border:"2px solid black"}),indicatorSeparator:t=>({...t,display:"none"})},placeholder:l?"載入中...":"選擇立法委員",isLoading:l,isClearable:!0,"aria-label":"選擇立法委員"})})},R=({onSelectionChange:d,className:a=""})=>{const u=i(c,e=>e.state.selectedValue),o=i(c,e=>e.state.searchedValue),l=i(c,e=>e.state.visible),m=i(c,e=>e.actions.toggleVisible),g=i(c,e=>e.actions.setSearchedValue),t=i(c,e=>e.actions.setSelectedValue),n=i(c,e=>e.actions.clearDepartmentFilter),y=i(c,e=>e.actions.clearPeopleFilter);p.useEffect(()=>{console.log("BudgetsSelector state:",{selectedValue:u,searchedValue:o})},[u,o]);const s=e=>{t(e),e!=="by-department"&&n(),e!=="by-legislator"&&y(),d&&d(e)};return r.jsxs("fieldset",{className:a,children:[r.jsx("legend",{className:"sr-only",children:h.pageTitle}),l?r.jsxs("div",{className:"mt-3 space-y-3",children:[h.options.map(e=>r.jsxs("div",{className:"flex flex-col items-center justify-start md:flex-row md:gap-x-2",children:[r.jsxs("div",{className:"mb-3 flex items-center md:mb-0",children:[r.jsx("input",{type:"radio",id:e.value,name:"budget-selector",value:e.value,checked:u===e.value,onChange:()=>s(e.value),className:"h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500"}),r.jsx("label",{htmlFor:e.value,className:"ml-3 block cursor-pointer text-sm font-medium text-gray-700",children:e.title})]}),u==="by-department"&&r.jsx(F,{value:e.value}),u==="by-legislator"&&r.jsx(V,{value:e.value})]},e.value)),r.jsxs("section",{className:"md:flex md:items-center",children:[r.jsx("label",{htmlFor:"budget-search-input",className:"mr-2",children:"或搜尋："}),r.jsx("input",{id:"budget-search-input",type:"search",placeholder:"輸入關鍵字搜尋",value:o,onChange:e=>g(e.target.value),className:"rounded-sm border-2 bg-white text-center md:w-80"})]}),r.jsxs("button",{className:"flex md:hidden",onClick:m,children:["收合",r.jsx(b,{src:"/icon/reverse-dropdown-container.svg",alt:"reverse-dropdown-container"})]})]}):r.jsxs("button",{className:"flex",onClick:m,children:["展開",r.jsx(b,{src:"/icon/dropdown-container.svg",alt:"dropdown-container"})]})]})};export{x as DropdownIndicator,R as default};
