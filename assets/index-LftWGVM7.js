import{p as e,y as I,I as $,a as c,G as B,J as F}from"./chunk-4WY6JWTD-2Cr-QbDP.js";import{t as G,u as E,P as O,j as _,O as Y}from"./gql-HYPlJro8.js";import{l as u}from"./lodash-lK2eycnc.js";import{b as h}from"./index-Ck08PhAW.js";import{C as K,e as Q,m as U,B as W,d as V,f as z,T as N,b,c as v}from"./tooltip-CDyB7B-4.js";import{I as w,p as H,e as J}from"./visualization.queries-gMEp7MMc.js";import"./helpers-CUKl9yx0.js";import"./index-CSMLMQiO.js";import"./index-CtMSh7YR.js";const Z=(s,a)=>a>1&&s<a-1?"border-b border-gray-200":"",X=({data:s,yearToCommitteeMap:a,onNodeClick:l})=>{const n=h("(min-width: 768px)"),i=h("(min-width: 1024px)"),t=h("(min-width: 1440px)"),m=h("(min-width: 1920px)"),f=()=>m?1800:t?1400:i?1e3:720;if(!s||s.length===0)return e.jsx("div",{className:"flex w-full items-center justify-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"目前無提案資料"})});const p=f(),d={maxWidth:`${p}px`};return e.jsx(e.Fragment,{children:s.map((o,j)=>e.jsxs("div",{className:`mb-2 flex w-full flex-col items-start justify-center ${Z(j,s.length)} mx-auto`,style:d,children:[e.jsxs("div",{className:"flex flex-col items-start justify-center w-full",children:[e.jsx("p",{children:o.name}),e.jsx("p",{children:a.get(o.name)??"委員會"})]}),e.jsx("div",{className:"w-full md:mx-auto",children:e.jsx(K,{data:{id:o.id,name:"root",children:o.children},width:p,padding:50,onNodeClick:l})})]},o.id))})},ee=G(`
  query People($where: PeopleWhereUniqueInput!) {
    people(where: $where) {
      id
      name
      party {
        id
        color
        name
      }
      term {
        termNumber
        id
      }
      termCount
      committees {
        id
        name
        session
        term {
          id
          startDate
          termNumber
        }
      }
    }
  }
`),C={all:["people"],details:()=>[...C.all,"detail"],detail:s=>[...C.details(),s]},se=s=>!s.first||!s.last?"":s.first===s.last?String(s.first):`${s.first} ~ ${s.last}`,ae=()=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"md:max-w-visualization-body flex flex-col items-center gap-y-6 px-3 md:mx-auto",children:[e.jsx("div",{className:"h-4 w-24 self-start rounded bg-gray-200"}),e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-6 w-32 rounded bg-gray-200"}),e.jsx("div",{className:"h-5 w-28 rounded bg-gray-200"}),e.jsx("div",{className:"h-5 w-40 rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex gap-x-4",children:[e.jsx("div",{className:"h-9 w-24 rounded bg-gray-200"}),e.jsx("div",{className:"h-9 w-24 rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"h-5 w-44 rounded bg-gray-200"}),e.jsx("div",{className:"h-5 w-56 rounded bg-gray-200"})]}),e.jsx("div",{className:"w-full rounded-lg border-2 border-dashed border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-48 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-52 rounded bg-gray-200"})]})}),e.jsx("div",{className:"h-10 w-full rounded bg-gray-200"}),e.jsx("div",{className:"flex w-full flex-col gap-y-6",children:[0,1].map(s=>e.jsxs("div",{className:"flex flex-col gap-y-3 rounded-lg border border-dashed border-gray-200 p-4",children:[e.jsx("div",{className:"h-5 w-32 rounded bg-gray-200"}),e.jsx("div",{className:"h-72 w-full rounded bg-gray-200"})]},s))})]})}),re=()=>e.jsx("div",{className:"animate-pulse px-3",children:e.jsxs("div",{className:"flex flex-col items-center gap-y-5",children:[e.jsx("div",{className:"h-4 w-20 self-start rounded bg-gray-200"}),e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-5 w-28 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-24 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-36 rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex w-full flex-col gap-y-3",children:[e.jsx("div",{className:"h-9 w-full rounded bg-gray-200"}),e.jsx("div",{className:"h-9 w-full rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-y-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-44 rounded bg-gray-200"})]}),e.jsx("div",{className:"w-full rounded-lg border-2 border-dashed border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-4 w-36 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-40 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-32 rounded bg-gray-200"})]})}),e.jsx("div",{className:"h-10 w-full rounded bg-gray-200"}),e.jsx("div",{className:"flex w-full flex-col gap-y-5",children:[0,1].map(s=>e.jsxs("div",{className:"flex flex-col gap-y-2 rounded-lg border border-dashed border-gray-200 p-4",children:[e.jsx("div",{className:"h-4 w-28 rounded bg-gray-200"}),e.jsx("div",{className:"h-64 w-full rounded bg-gray-200"})]},s))})]})}),te=({isDesktop:s})=>s?e.jsx(ae,{}):e.jsx(re,{}),le=(s,a)=>s==="proposal-cosign"?{OR:[{proposers:{some:{id:{equals:a}}}},{coSigners:{some:{id:{equals:a}}}}]}:{proposers:{some:{id:{equals:a}}}},ne=s=>{if(!s)return new Map;const a=new Map;return s.forEach(l=>{var r;if((r=l.term)!=null&&r.startDate){const i=new Date(l.term.startDate).getFullYear()-1911+1;a.set(`${i}年度`,l.name??"委員會")}}),a},ie=s=>{if(!s)return{first:null,last:null};const a=s.map(r=>{var n;return(n=r.term)==null?void 0:n.termNumber}).filter(r=>r!=null);if(a.length===0)return{first:null,last:null};const l=[...new Set(a)].sort((r,n)=>r-n);return{first:l[0],last:l[l.length-1]}},de=s=>{const a=u.sumBy(s,t=>t.reductionAmount||0),l=u.sumBy(s,t=>t.freezeAmount||0),r=u.filter(s,t=>t.reductionAmount).length,n=u.filter(s,t=>t.freezeAmount).length,i=u.filter(s,t=>{var m;return(m=t.proposalTypes)==null?void 0:m.includes(O.Other)}).length;return{formattedReductionAmount:z(a),formattedFreezeAmount:z(l),reductionProposalsCount:r,freezeProposalsCount:n,mainResolutionCount:i}},ce=({personName:s,partyName:a,termRange:l})=>e.jsxs("div",{className:"mt-4 flex flex-col items-center justify-center gap-y-2",children:[e.jsx("p",{children:s}),e.jsx("p",{children:a}),e.jsxs("p",{children:["第",se(l),"屆立法委員"]})]}),oe=({selectedType:s,onChange:a})=>e.jsxs("div",{className:"mt-6 flex items-center gap-x-4",children:[e.jsx("button",{className:`rounded border-2 border-black px-2.5 ${s==="proposal"?"bg-brand-primary text-white":""}`,onClick:()=>a("proposal"),children:"提案"}),e.jsx("button",{className:`rounded border-2 border-black px-2.5 ${s==="proposal-cosign"?"bg-brand-primary text-white":""}`,onClick:()=>a("proposal-cosign"),children:"提案＋連署"})]}),me=({mode:s,onChange:a})=>e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"viz-mode",value:"amount",checked:s==="amount",onChange:()=>a("amount"),className:"accent-brand-primary h-4 w-4"}),e.jsx("span",{children:"依金額（刪減/凍結）"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"viz-mode",value:"count",checked:s==="count",onChange:()=>a("count"),className:"accent-brand-primary h-4 w-4"}),e.jsx("span",{children:"依數量（凍結案/刪減案/建議案）"})]})]})}),xe=({summary:s})=>e.jsxs("div",{className:"mt-4 flex flex-col items-center justify-center rounded-lg border-2 p-2.5",children:[e.jsxs("p",{children:["總共刪減",e.jsx("span",{className:"text-brand-accent",children:s.formattedReductionAmount}),"（",e.jsx("span",{className:"text-brand-accent",children:s.reductionProposalsCount}),"個提案）",e.jsxs(N,{children:[e.jsx(b,{asChild:!0,children:e.jsx("span",{className:"ml-1 inline-flex",children:e.jsx(w,{src:"/icon/icon-explain.svg",alt:"說明",className:"h-4 w-4"})})}),e.jsx(v,{className:"bg-black text-white",children:"刪減案相關說明"})]})]}),e.jsxs("p",{children:["凍結",e.jsx("span",{className:"text-brand-accent",children:s.formattedFreezeAmount}),"（",e.jsx("span",{className:"text-brand-accent",children:s.freezeProposalsCount}),"個提案）",e.jsxs(N,{children:[e.jsx(b,{asChild:!0,children:e.jsx("span",{className:"ml-1 inline-flex",children:e.jsx(w,{src:"/icon/icon-explain.svg",alt:"說明",className:"h-4 w-4"})})}),e.jsx(v,{className:"bg-black text-white",children:"凍結案相關說明"})]})]}),e.jsxs("p",{children:["主決議提案數：",e.jsx("span",{className:"text-brand-accent",children:s.mainResolutionCount}),"個",e.jsxs(N,{children:[e.jsx(b,{asChild:!0,children:e.jsx("span",{className:"ml-1 inline-flex",children:e.jsx(w,{src:"/icon/icon-explain.svg",alt:"說明",className:"h-4 w-4"})})}),e.jsx(v,{className:"bg-black text-white",children:"主決議提案相關說明"})]})]})]}),ue=()=>{var S,k;const{id:s}=$(),[a,l]=c.useState("proposal"),[r,n]=c.useState("amount"),i=c.useMemo(()=>le(a,s),[a,s]),{data:t,isLoading:m,isError:f}=E({queryKey:H.list({whereFilter:i}),queryFn:()=>_(J,{skip:0,take:1e3,orderBy:[{id:Y.Desc}],where:i})}),p=c.useMemo(()=>t?Q(t,r):[],[t,r]),{data:d,isLoading:o,isError:j}=E({queryKey:C.detail(s??""),queryFn:()=>_(ee,{where:{id:s}}),enabled:!!s}),g=(S=d==null?void 0:d.people)==null?void 0:S.committees,D=c.useMemo(()=>ne(g),[g]),M=c.useMemo(()=>ie(g),[g]),x=d==null?void 0:d.people,T=U(t),L=c.useMemo(()=>de(T),[T]),R=h("(min-width: 768px)"),P=B(),q=c.useCallback(y=>{var A;return!((A=y.children)!=null&&A.length)&&y.id?(P(`/budget/${y.id}`),!0):!1},[P]);return m||o?e.jsx(te,{isDesktop:R}):f||j?e.jsx("div",{children:"Error fetching data"}):e.jsx("div",{children:e.jsxs("div",{className:"md:max-w-visualization-body flex flex-col items-center justify-center px-3 md:mx-auto",children:[e.jsxs(F,{to:"/visualization",children:["<"," 回到視覺化主頁"]}),e.jsx(ce,{personName:x==null?void 0:x.name,partyName:(k=x==null?void 0:x.party)==null?void 0:k.name,termRange:M}),e.jsx(oe,{selectedType:a,onChange:l}),e.jsx(me,{mode:r,onChange:n}),e.jsx(xe,{summary:L}),e.jsx("div",{className:"mt-6",children:e.jsx(W,{items:V})}),e.jsx(X,{data:p,yearToCommitteeMap:D,onNodeClick:q})]})})},we=I(ue);export{we as default};
