import{p as s,a as y}from"./chunk-FGUA77HG-BrA7_UWl.js";import{u as v,j}from"./gql-B-mwqB7Q.js";import{I as g,g as C,h as N,i as w,j as I}from"./visualization.queries-9AKN3csb.js";import{d as c}from"./index-CFLFLCvc.js";import{c as F,S as x}from"./react-select.esm-CnZKZ7WR.js";import{y as i}from"./middleware-CqloAJtN.js";import"./progress-stages-526PVMKw.js";import"./index-D4o5tLmX.js";import"./helpers-j5VDf7UR.js";import"./floating-ui.dom-D7dPsNSj.js";import"./hoist-non-react-statics.cjs-Dro-b_67.js";import"./index-BU5Ik6l7.js";const h={pageTitle:"選擇預算分類方式:",options:[{title:"全部",value:"all"},{title:"依部會分類",value:"by-department"},{title:"依立委分類",value:"by-legislator"}]},f=d=>s.jsx(F.DropdownIndicator,{...d,children:s.jsx(g,{src:"/icon/dropdown-container.svg",alt:"dropdown",className:"h-2 w-2.5"})}),V=({value:d})=>{const n=i(c,r=>r.state.departmentFilter),u=i(c,r=>r.actions.setDepartmentCategory),a=i(c,r=>r.actions.setDepartmentId),{data:l,isLoading:m}=v({queryKey:C.lists(),queryFn:()=>j(N),enabled:d==="by-department"}),p=y.useMemo(()=>l!=null&&l.governments?Array.from(new Set(l.governments.map(e=>e.category).filter(e=>e!=null&&e!==""))).sort().map(e=>({value:e,label:e})):[],[l==null?void 0:l.governments]),t=y.useMemo(()=>!(l!=null&&l.governments)||!n.category?[]:l.governments.filter(e=>e.category===n.category).map(e=>({value:e.id,label:e.name||"未命名機關"})).sort((e,S)=>e.label.localeCompare(S.label)),[l==null?void 0:l.governments,n.category]),o=n.category?{value:n.category,label:n.category}:null,b=y.useMemo(()=>{if(!n.departmentId||!(l!=null&&l.governments))return null;const r=l.governments.find(e=>e.id===n.departmentId);return r?{value:r.id,label:r.name||"未命名機關"}:null},[n.departmentId,l==null?void 0:l.governments]);return d!=="by-department"?null:s.jsxs("div",{className:"flex flex-col gap-y-3 md:flex-row md:gap-x-2",children:[s.jsx(x,{value:o,onChange:r=>{const e=r;u((e==null?void 0:e.value)||null)},options:p,components:{DropdownIndicator:f},styles:{control:r=>({...r,border:"2px solid black"}),indicatorSeparator:r=>({...r,display:"none"})},placeholder:m?"載入中...":"選擇機關類別",isLoading:m,isClearable:!0,"aria-label":"選擇機關類別"}),s.jsx(x,{value:b,onChange:r=>{const e=r;a((e==null?void 0:e.value)||null)},options:t,components:{DropdownIndicator:f},styles:{control:r=>({...r,border:"2px solid black"}),indicatorSeparator:r=>({...r,display:"none"})},placeholder:n.category?t.length===0?"此類別無機關":"選擇機關名稱":"請先選擇類別",isDisabled:!n.category||t.length===0,isClearable:!0,"aria-label":"選擇機關名稱"})]})},E=({value:d})=>{const n=i(c,t=>t.state.peopleFilter.personId),u=i(c,t=>t.actions.setPersonId),{data:a,isLoading:l}=v({queryKey:w.lists(),queryFn:()=>j(I),enabled:d==="by-legislator"}),m=y.useMemo(()=>a!=null&&a.peopleList?a.peopleList.filter(t=>t.name).map(t=>{var o;return{value:t.id,label:t.name||"未命名",party:((o=t.party)==null?void 0:o.name)||null}}).sort((t,o)=>t.label.localeCompare(o.label)):[],[a==null?void 0:a.peopleList]),p=y.useMemo(()=>{if(!n||!(a!=null&&a.peopleList))return null;const t=a.peopleList.find(o=>o.id===n);return t?{value:t.id,label:t.name||"未命名"}:null},[n,a==null?void 0:a.peopleList]);return d!=="by-legislator"?null:s.jsx("div",{className:"flex flex-col gap-y-3",children:s.jsx(x,{value:p,onChange:t=>{const o=t;u((o==null?void 0:o.value)||null)},options:m,components:{DropdownIndicator:f},className:"md:w-96",styles:{control:t=>({...t,border:"2px solid black"}),indicatorSeparator:t=>({...t,display:"none"})},placeholder:l?"載入中...":"選擇立法委員",isLoading:l,isClearable:!0,"aria-label":"選擇立法委員"})})},G=({onSelectionChange:d,className:n=""})=>{const u=i(c,e=>e.state.selectedValue),a=i(c,e=>e.state.searchedValue),l=i(c,e=>e.state.visible),m=i(c,e=>e.actions.toggleVisible),p=i(c,e=>e.actions.setSearchedValue),t=i(c,e=>e.actions.setSelectedValue),o=i(c,e=>e.actions.clearDepartmentFilter),b=i(c,e=>e.actions.clearPeopleFilter),r=e=>{t(e),e!=="by-department"&&o(),e!=="by-legislator"&&b(),d&&d(e)};return s.jsxs("fieldset",{className:n,children:[s.jsx("legend",{className:"sr-only",children:h.pageTitle}),l?s.jsxs("div",{className:"mt-3 space-y-3",children:[h.options.map(e=>s.jsxs("div",{className:"flex flex-col items-center justify-start md:flex-row md:gap-x-2",children:[s.jsxs("div",{className:"mb-3 flex items-center md:mb-0",children:[s.jsx("input",{type:"radio",id:e.value,name:"budget-selector",value:e.value,checked:u===e.value,onChange:()=>r(e.value),className:"h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("label",{htmlFor:e.value,className:"ml-3 block cursor-pointer text-sm font-medium text-gray-700",children:e.title})]}),u==="by-department"&&s.jsx(V,{value:e.value}),u==="by-legislator"&&s.jsx(E,{value:e.value})]},e.value)),s.jsxs("section",{className:"md:flex md:items-center",children:[s.jsx("label",{htmlFor:"budget-search-input",className:"mr-2",children:"或搜尋："}),s.jsx("input",{id:"budget-search-input",type:"search",placeholder:"輸入關鍵字搜尋",value:a,onChange:e=>p(e.target.value),className:"rounded-sm border-2 bg-white text-center md:w-80"})]}),s.jsxs("button",{className:"flex md:hidden",onClick:m,children:["收合",s.jsx(g,{src:"/icon/reverse-dropdown-container.svg",alt:"reverse-dropdown-container"})]})]}):s.jsxs("button",{className:"flex",onClick:m,children:["展開",s.jsx(g,{src:"/icon/dropdown-container.svg",alt:"dropdown-container"})]})]})};export{f as DropdownIndicator,G as default};
