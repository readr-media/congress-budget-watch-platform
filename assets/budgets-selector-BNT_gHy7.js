import{p as t,a as y}from"./chunk-EPOLDU6W-DQ8jUjc-.js";import{u as N,k as S}from"./gql-DluIoxkA.js";import{I as f,i as w,j as C,k as F,l as I}from"./visualization.queries-BsEKD65O.js";import{d as i,u as k,a as V}from"./index-DnPMy5-b.js";import{c as E,S as h}from"./react-select.esm-Twz0-5LX.js";import{y as d}from"./middleware-Bgy6GSHg.js";import"./unfreeze-progress-CwQ6uulY.js";import"./index-DiZi5jo9.js";import"./helpers-DpWkFamx.js";import"./hoist-non-react-statics.cjs-Di0T_dwh.js";import"./index-CwwoWIrx.js";const j={pageTitle:"選擇預算分類方式:",options:[{title:"全部",value:"all"},{title:"依部會分類",value:"by-department"},{title:"依立委分類",value:"by-legislator"}]},v=u=>t.jsx(E.DropdownIndicator,{...u,children:t.jsx(f,{src:"/icon/dropdown-container.svg",alt:"dropdown",className:"h-2 w-2.5"})}),L=({value:u})=>{const o=d(i,l=>l.state.departmentFilter),m=d(i,l=>l.actions.setDepartmentCategory),n=d(i,l=>l.actions.setDepartmentId),{data:a,isLoading:p}=N({queryKey:C.lists(),queryFn:()=>S(w),enabled:u==="by-department"}),x=y.useMemo(()=>a!=null&&a.governments?Array.from(new Set(a.governments.map(r=>r.category).filter(r=>r!=null&&r!==""))).sort().map(r=>({value:r,label:r})):[],[a==null?void 0:a.governments]),s=y.useMemo(()=>!(a!=null&&a.governments)||!o.category?[]:a.governments.filter(r=>r.category===o.category).map(r=>({value:r.id,label:r.name||"未命名機關"})).sort((r,g)=>r.label.localeCompare(g.label)),[a==null?void 0:a.governments,o.category]),c=o.category?{value:o.category,label:o.category}:null,b=y.useMemo(()=>{if(!o.departmentId||!(a!=null&&a.governments))return null;const l=a.governments.find(r=>r.id===o.departmentId);return l?{value:l.id,label:l.name||"未命名機關"}:null},[o.departmentId,a==null?void 0:a.governments]);return u!=="by-department"?null:t.jsxs("div",{className:"flex flex-col gap-y-3 md:flex-row md:gap-x-2",children:[t.jsx(h,{value:c,onChange:l=>{const r=l;m((r==null?void 0:r.value)||null)},options:x,components:{DropdownIndicator:v},styles:{control:l=>({...l,border:"2px solid black"}),indicatorSeparator:l=>({...l,display:"none"})},placeholder:p?"載入中...":"選擇機關類別",isLoading:p,isClearable:!0,"aria-label":"選擇機關類別"}),t.jsx(h,{value:b,onChange:l=>{const r=l;n((r==null?void 0:r.value)||null)},options:s,components:{DropdownIndicator:v},styles:{control:l=>({...l,border:"2px solid black"}),indicatorSeparator:l=>({...l,display:"none"})},placeholder:o.category?s.length===0?"此類別無機關":"選擇機關名稱":"請先選擇類別",isDisabled:!o.category||s.length===0,isClearable:!0,"aria-label":"選擇機關名稱"})]})},O=({value:u})=>{const o=d(i,s=>s.state.peopleFilter.personId),m=d(i,s=>s.actions.setPersonId),{data:n,isLoading:a}=N({queryKey:I.lists(),queryFn:()=>S(F),enabled:u==="by-legislator"}),p=y.useMemo(()=>n!=null&&n.peopleList?n.peopleList.filter(s=>s.name).map(s=>{var c;return{value:s.id,label:s.name||"未命名",party:((c=s.party)==null?void 0:c.name)||null}}).sort((s,c)=>s.label.localeCompare(c.label)):[],[n==null?void 0:n.peopleList]),x=y.useMemo(()=>{if(!o||!(n!=null&&n.peopleList))return null;const s=n.peopleList.find(c=>c.id===o);return s?{value:s.id,label:s.name||"未命名"}:null},[o,n==null?void 0:n.peopleList]);return u!=="by-legislator"?null:t.jsx("div",{className:"flex flex-col gap-y-3",children:t.jsx(h,{value:x,onChange:s=>{const c=s;m((c==null?void 0:c.value)||null)},options:p,components:{DropdownIndicator:v},className:"md:w-96",styles:{control:s=>({...s,border:"2px solid black"}),indicatorSeparator:s=>({...s,display:"none"})},placeholder:a?"載入中...":"選擇立法委員",isLoading:a,isClearable:!0,"aria-label":"選擇立法委員"})})},U=({onSelectionChange:u,className:o=""})=>{const m=d(i,e=>e.state.selectedValue),n=d(i,e=>e.state.searchedValue),a=d(i,e=>e.state.visible),p=d(i,e=>e.actions.toggleVisible),x=d(i,e=>e.actions.setSearchedValue),s=d(i,e=>e.actions.setSelectedValue),c=d(i,e=>e.actions.clearDepartmentFilter),b=d(i,e=>e.actions.clearPeopleFilter),l=k(),r=V(),g=e=>{s(e),e!=="by-department"&&c(),e!=="by-legislator"&&b(),u&&u(e)};return t.jsxs("fieldset",{className:o,children:[t.jsx("legend",{className:"sr-only",children:j.pageTitle}),a?t.jsxs("div",{className:"mt-3 space-y-3",children:[t.jsxs("div",{className:"flex w-full items-center justify-center gap-x-4 text-sm font-medium text-black",children:[t.jsxs("label",{className:"flex items-center gap-x-2",children:[t.jsx("input",{type:"radio",name:"freeze-filter",value:"all",checked:!l,onChange:()=>r(!1),className:"h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500"}),t.jsx("span",{className:l?"text-gray-500":"text-black",children:"全部"})]}),t.jsxs("label",{className:"flex items-center gap-x-2",children:[t.jsx("input",{type:"radio",name:"freeze-filter",value:"freeze-only",checked:l,onChange:()=>r(!0),className:"h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500"}),t.jsx("span",{className:l?"text-[#e9808e]":"text-gray-500",children:"解凍"})]})]}),j.options.map(e=>t.jsxs("div",{className:"flex flex-col items-center justify-start md:flex-row md:gap-x-2",children:[t.jsxs("div",{className:"mb-3 flex items-center md:mb-0",children:[t.jsx("input",{type:"radio",id:e.value,name:"budget-selector",value:e.value,checked:m===e.value,onChange:()=>g(e.value),className:"h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500"}),t.jsx("label",{htmlFor:e.value,className:"ml-3 block cursor-pointer text-sm font-medium text-gray-700",children:e.title})]}),m==="by-department"&&t.jsx(L,{value:e.value}),m==="by-legislator"&&t.jsx(O,{value:e.value})]},e.value)),t.jsxs("section",{className:"md:flex md:items-center",children:[t.jsx("label",{htmlFor:"budget-search-input",className:"mr-2",children:"或搜尋："}),t.jsx("input",{id:"budget-search-input",type:"search",placeholder:"輸入關鍵字搜尋",value:n,onChange:e=>x(e.target.value),className:"rounded-sm border-2 bg-white text-center md:w-80"})]}),t.jsxs("button",{className:"flex md:hidden",onClick:p,children:["收合",t.jsx(f,{src:"/icon/reverse-dropdown-container.svg",alt:"reverse-dropdown-container"})]})]}):t.jsxs("button",{className:"flex",onClick:p,children:["展開",t.jsx(f,{src:"/icon/dropdown-container.svg",alt:"dropdown-container"})]})]})};export{v as DropdownIndicator,U as default};
