import{a as i,p as e,y as M,I as L,G as R,J as q}from"./chunk-4WY6JWTD-CgHlDcFV.js";import{t as B,u as C,P as F,j as P,O as I}from"./gql-eqnbwCfF.js";import{l as x}from"./lodash-BaJ8qq35.js";import{u as h}from"./helpers-D_nHFrcV.js";import{C as $,c as G,m as O,B as Y,b as K,f as S}from"./legends-DCFyqHca.js";import{p as Q,e as U}from"./visualization.queries-0YyIa-Dn.js";const V=(s,r)=>r>1&&s<r-1?"border-b border-gray-200":"",W=({data:s,yearToCommitteeMap:r,onNodeClick:l})=>{const n=h("(min-width: 768px)"),d=h("(min-width: 1024px)"),t=h("(min-width: 1440px)"),m=h("(min-width: 1920px)"),g=()=>{if(m)return 1800;if(t)return 1400;if(d)return 1e3;if(n)return 720};return i.useEffect(()=>{}),!s||s.length===0?e.jsx("div",{className:"flex w-full items-center justify-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"目前無提案資料"})}):e.jsx(e.Fragment,{children:s.map((c,o)=>e.jsxs("div",{className:`mb-2 flex w-full flex-col items-start justify-center ${V(o,s.length)}`,children:[e.jsxs("div",{className:"flex flex-col items-start justify-center",children:[e.jsx("p",{children:c.name}),e.jsx("p",{children:r.get(c.name)??"委員會"})]}),e.jsx("div",{className:"md:mx-auto",children:e.jsx($,{data:{id:c.id,name:"root",children:c.children},width:g(),padding:50,onNodeClick:l})})]},c.id))})},H=B(`
  query People($where: PeopleWhereUniqueInput!) {
    people(where: $where) {
      id
      name
      party {
        id
        color
        name
      }
      term {
        termNumber
        id
      }
      termCount
      committees {
        id
        name
        session
        term {
          id
          startDate
          termNumber
        }
      }
    }
  }
`),j={all:["people"],details:()=>[...j.all,"detail"],detail:s=>[...j.details(),s]},J=s=>!s.first||!s.last?"":s.first===s.last?String(s.first):`${s.first} ~ ${s.last}`,Z=()=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"md:max-w-visualization-body flex flex-col items-center gap-y-6 px-3 md:mx-auto",children:[e.jsx("div",{className:"h-4 w-24 self-start rounded bg-gray-200"}),e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-6 w-32 rounded bg-gray-200"}),e.jsx("div",{className:"h-5 w-28 rounded bg-gray-200"}),e.jsx("div",{className:"h-5 w-40 rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex gap-x-4",children:[e.jsx("div",{className:"h-9 w-24 rounded bg-gray-200"}),e.jsx("div",{className:"h-9 w-24 rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"h-5 w-44 rounded bg-gray-200"}),e.jsx("div",{className:"h-5 w-56 rounded bg-gray-200"})]}),e.jsx("div",{className:"w-full rounded-lg border-2 border-dashed border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-48 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-52 rounded bg-gray-200"})]})}),e.jsx("div",{className:"h-10 w-full rounded bg-gray-200"}),e.jsx("div",{className:"flex w-full flex-col gap-y-6",children:[0,1].map(s=>e.jsxs("div",{className:"flex flex-col gap-y-3 rounded-lg border border-dashed border-gray-200 p-4",children:[e.jsx("div",{className:"h-5 w-32 rounded bg-gray-200"}),e.jsx("div",{className:"h-72 w-full rounded bg-gray-200"})]},s))})]})}),X=()=>e.jsx("div",{className:"animate-pulse px-3",children:e.jsxs("div",{className:"flex flex-col items-center gap-y-5",children:[e.jsx("div",{className:"h-4 w-20 self-start rounded bg-gray-200"}),e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-5 w-28 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-24 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-36 rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex w-full flex-col gap-y-3",children:[e.jsx("div",{className:"h-9 w-full rounded bg-gray-200"}),e.jsx("div",{className:"h-9 w-full rounded bg-gray-200"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-y-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-44 rounded bg-gray-200"})]}),e.jsx("div",{className:"w-full rounded-lg border-2 border-dashed border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-y-2",children:[e.jsx("div",{className:"h-4 w-36 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-40 rounded bg-gray-200"}),e.jsx("div",{className:"h-4 w-32 rounded bg-gray-200"})]})}),e.jsx("div",{className:"h-10 w-full rounded bg-gray-200"}),e.jsx("div",{className:"flex w-full flex-col gap-y-5",children:[0,1].map(s=>e.jsxs("div",{className:"flex flex-col gap-y-2 rounded-lg border border-dashed border-gray-200 p-4",children:[e.jsx("div",{className:"h-4 w-28 rounded bg-gray-200"}),e.jsx("div",{className:"h-64 w-full rounded bg-gray-200"})]},s))})]})}),ee=({isDesktop:s})=>s?e.jsx(Z,{}):e.jsx(X,{}),se=(s,r)=>s==="proposal-cosign"?{OR:[{proposers:{some:{id:{equals:r}}}},{coSigners:{some:{id:{equals:r}}}}]}:{proposers:{some:{id:{equals:r}}}},re=s=>{if(!s)return new Map;const r=new Map;return s.forEach(l=>{var a;if((a=l.term)!=null&&a.startDate){const d=new Date(l.term.startDate).getFullYear()-1911+1;r.set(`${d}年度`,l.name??"委員會")}}),r},ae=s=>{if(!s)return{first:null,last:null};const r=s.map(a=>{var n;return(n=a.term)==null?void 0:n.termNumber}).filter(a=>a!=null);if(r.length===0)return{first:null,last:null};const l=[...new Set(r)].sort((a,n)=>a-n);return{first:l[0],last:l[l.length-1]}},te=s=>{const r=x.sumBy(s,t=>t.reductionAmount||0),l=x.sumBy(s,t=>t.freezeAmount||0),a=x.filter(s,t=>t.reductionAmount).length,n=x.filter(s,t=>t.freezeAmount).length,d=x.filter(s,t=>{var m;return(m=t.proposalTypes)==null?void 0:m.includes(F.Other)}).length;return{formattedReductionAmount:S(r),formattedFreezeAmount:S(l),reductionProposalsCount:a,freezeProposalsCount:n,mainResolutionCount:d}},le=({personName:s,partyName:r,termRange:l})=>e.jsxs("div",{className:"mt-4 flex flex-col items-center justify-center gap-y-2",children:[e.jsx("p",{children:s}),e.jsx("p",{children:r}),e.jsxs("p",{children:["第",J(l),"屆立法委員"]})]}),ne=({selectedType:s,onChange:r})=>e.jsxs("div",{className:"mt-6 flex items-center gap-x-4",children:[e.jsx("button",{className:`rounded border-2 border-black px-2.5 ${s==="proposal"?"bg-brand-primary text-white":""}`,onClick:()=>r("proposal"),children:"提案"}),e.jsx("button",{className:`rounded border-2 border-black px-2.5 ${s==="proposal-cosign"?"bg-brand-primary text-white":""}`,onClick:()=>r("proposal-cosign"),children:"提案＋連署"})]}),ie=({mode:s,onChange:r})=>e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"viz-mode",value:"amount",checked:s==="amount",onChange:()=>r("amount"),className:"accent-brand-primary h-4 w-4"}),e.jsx("span",{children:"依金額（刪減/凍結）"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"viz-mode",value:"count",checked:s==="count",onChange:()=>r("count"),className:"accent-brand-primary h-4 w-4"}),e.jsx("span",{children:"依數量（凍結案/刪減案/建議案）"})]})]})}),de=({summary:s})=>e.jsxs("div",{className:"mt-4 flex flex-col items-center justify-center rounded-lg border-2 p-2.5",children:[e.jsxs("p",{children:["總共刪減",e.jsx("span",{className:"text-brand-accent",children:s.formattedReductionAmount}),"（",e.jsx("span",{className:"text-brand-accent",children:s.reductionProposalsCount}),"個提案）"]}),e.jsxs("p",{children:["凍結",e.jsx("span",{className:"text-brand-accent",children:s.formattedFreezeAmount}),"（",e.jsx("span",{className:"text-brand-accent",children:s.freezeProposalsCount}),"個提案）"]}),e.jsxs("p",{children:["主決議提案數：",e.jsx("span",{className:"text-brand-accent",children:s.mainResolutionCount}),"個"]})]}),oe=()=>{var b,v;const{id:s}=L(),[r,l]=i.useState("proposal"),[a,n]=i.useState("amount"),d=i.useMemo(()=>se(r,s),[r,s]),{data:t,isLoading:m,isError:g}=C({queryKey:Q.list({whereFilter:d}),queryFn:()=>P(U,{skip:0,take:1e3,orderBy:[{id:I.Desc}],where:d})}),c=i.useMemo(()=>t?G(t,a):[],[t,a]),{data:o,isLoading:T,isError:E}=C({queryKey:j.detail(s??""),queryFn:()=>P(H,{where:{id:s}}),enabled:!!s}),p=(b=o==null?void 0:o.people)==null?void 0:b.committees,A=i.useMemo(()=>re(p),[p]),k=i.useMemo(()=>ae(p),[p]),u=o==null?void 0:o.people,y=O(t),_=i.useMemo(()=>te(y),[y]),z=h("(min-width: 768px)"),N=R(),D=i.useCallback(f=>{var w;return!((w=f.children)!=null&&w.length)&&f.id?(N(`/budget/${f.id}`),!0):!1},[N]);return m||T?e.jsx(ee,{isDesktop:z}):g||E?e.jsx("div",{children:"Error fetching data"}):e.jsx("div",{children:e.jsxs("div",{className:"md:max-w-visualization-body flex flex-col items-center justify-center px-3 md:mx-auto",children:[e.jsxs(q,{to:"/visualization",children:["<"," 回到視覺化主頁"]}),e.jsx(le,{personName:u==null?void 0:u.name,partyName:(v=u==null?void 0:u.party)==null?void 0:v.name,termRange:k}),e.jsx(ne,{selectedType:r,onChange:l}),e.jsx(ie,{mode:a,onChange:n}),e.jsx(de,{summary:_}),e.jsx("div",{className:"mt-6",children:e.jsx(Y,{items:K})}),e.jsx(W,{data:c,yearToCommitteeMap:A,onNodeClick:D})]})})},ge=M(oe);export{ge as default};
